<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tugas Besar | Grafika Komputer</title>
    <style>
      #canvas {
        border: 2px solid black;
      }
      #canvas2 {
        border: 2px solid black;
      }
    </style>
    <script src="./Library.js"></script>
  </head>
  <body>
    <div>
      <input type="color" id="colorPicker" name="colorPicker" value="#e66465" />
      <label for="head">Head</label>
    </div>
    <canvas id="canvas" width="400" height="400"></canvas>
    <button id="buttonMenggambar" type="submit" onclick="menggambar()">
      Menggambar
    </button>
    <button id="buttonMewarnai" type="submit" onclick="mewarnai()">
      Mewarnai
    </button>
    <button id="button" type="submit" onclick="copy()">Copy</button>
    <canvas id="canvas2" width="400" height="400"></canvas>

    <script>
      const updateAll = (event) => {
        color = event.target.value;
      };
      var defaultColor = "#0000ff";
      var colorPicker = document.querySelector("#colorPicker");
      colorPicker.addEventListener("change", updateAll, false);
      colorPicker.value = defaultColor;
      color = "";

      function hexToRgb(hex) {
        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result
          ? {
              r: parseInt(result[1], 16),
              g: parseInt(result[2], 16),
              b: parseInt(result[3], 16),
            }
          : null;
      }
      // var color = hexToRgb(colorPicker.value);
      var canvas = document.querySelector("#canvas");
      var ctx = canvas.getContext("2d");
      var imageData = ctx.getImageData(
        0,
        0,
        canvas.clientWidth,
        canvas.clientHeight
      );

      var array = [];
      var array2 = [];
      var warna = false;
      const canvas2 = (array, color) => {
        var toFlood = { r: 0, g: 0, b: 0 };

        var canvas2 = document.querySelector("#canvas2");
        var ctx2 = canvas2.getContext("2d");
        var imageData2 = ctx2.getImageData(
          0,
          0,
          canvas2.clientWidth,
          canvas2.clientHeight
        );

        {
          array > 0 ? polygon(imageData2, array, 255, 0, 0) : null;
        }
        {
          array2 > 0
            ? floodFillStack(
                imageData2,
                canvas2,
                array2[0].x,
                array2[0].y,
                toFlood,
                color
              )
            : null;
        }

        ctx2.putImageData(imageData2, 0, 0);
      };
      const copy = () => {
        canvas2(array, color);
        console.log(color);
      };

      const menggambar = () => {
        warna = false;
      };
      const mewarnai = () => {
        warna = true;
      };
      canvas.addEventListener("click", function (e) {
        if (warna == false) {
          array.push({ x: e.offsetX, y: e.offsetY });
          console.log(array);
          console.log(array.length);
          polygon(imageData, array, 255, 0, 0);
          ctx.putImageData(imageData, 0, 0);
          console.log(warna);
        } else {
          var toFlood = { r: 0, g: 0, b: 0 };

          var x = e.offsetX;
          var y = e.offsetY;
          floodFillStack(imageData, canvas, x, y, toFlood, color);
          array2.push({ x: x, y: y });
          console.log(warna);

          ctx.putImageData(imageData, 0, 0);
        }
      });

      ctx.putImageData(imageData, 0, 0);
    </script>
  </body>
</html>
